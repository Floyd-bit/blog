(window.webpackJsonp=window.webpackJsonp||[]).push([[83],{682:function(t,s,a){"use strict";a.r(s);var n=a(11),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h3",{attrs:{id:"_1-跨域问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-跨域问题"}},[t._v("#")]),t._v(" 1. 跨域问题")]),t._v(" "),a("p",[t._v("浏览器的"),a("strong",[t._v("同源策略")]),t._v("： 浏览器只能访问与包含它的页面处于同一个域内的资源")]),t._v(" "),a("p",[a("strong",[t._v("跨域并不是请求发不出去，服务端能收到请求并正常返回结果，只是结果被浏览器拦截了")])]),t._v(" "),a("h3",{attrs:{id:"_2-jsonp-参数式json"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-jsonp-参数式json"}},[t._v("#")]),t._v(" 2. JSONP (参数式JSON)")]),t._v(" "),a("p",[a("strong",[t._v("只支持GET请求")])]),t._v(" "),a("p",[t._v('利用<script>标签没有同源策略的限制的特性，通过动态创建script标签，其中src属性参数为请求api地址+"callback=functionName"，声明一个回调函数接收response;')]),t._v(" "),a("p",[t._v("jsonp由"),a("strong",[t._v("回调函数")]),t._v("和"),a("strong",[t._v("数据")]),t._v("组成，回调函数是当响应到来时应该在页面中调用的函数，数据是传入回调函数中的JSON数据")]),t._v(" "),a("p",[t._v("优点：对各款浏览器的兼容性比较好； 可以在后端没有配置cors的情况下使用")]),t._v(" "),a("p",[t._v("缺点：只支持Get请求；且参数直接在url中传递，安全性较差，容易收到xss攻击")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handleResponse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("response")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// jsonp通过动态script元素使用")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" script "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'script'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// src属性指定一个跨域URL")]),t._v("\nscript"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://www.xxx.com/json/?callback=handleresponse"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("insertBefore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("firstChild"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"_3-cors-跨域资源共享"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-cors-跨域资源共享"}},[t._v("#")]),t._v(" 3. CORS (跨域资源共享)")]),t._v(" "),a("p",[t._v("关键是服务器实现CORS的接口(设置"),a("em",[t._v("Access-Control-Allow-Origin")]),t._v(")")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("简单请求：浏览器直接发出CORS请求，在请求头中增加Origin字段")]),t._v(" "),a("p",[t._v("请求的方法只能是HEAD GET POST")]),t._v(" "),a("p",[t._v("头部信息字段有限")])]),t._v(" "),a("li",[a("p",[t._v("非简单请求: 在发送请求之前，增加一次HTTP请求——预检 (OPTION请求)")]),t._v(" "),a("p",[t._v("请求方法为PUT DELETE")]),t._v(" "),a("p",[t._v("Content-Type字段的类型是application/json")])])]),t._v(" "),a("h3",{attrs:{id:"_4-iframe-postmessage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-iframe-postmessage"}},[t._v("#")]),t._v(" 4. iframe(postMessage)")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 给B页面发送消息")]),t._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("frames"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 接收B页面发来的消息")]),t._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'message'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h3",{attrs:{id:"_5-websocket"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-websocket"}},[t._v("#")]),t._v(" 5. webSocket")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" ws "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebSocket")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'wss://echo.websocket.org'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nws"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onopen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("evt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ws"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nws"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onmessage")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("evt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ws"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nws"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onclose")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("evt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'close'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"_6-document-domain-iframe"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-document-domain-iframe"}},[t._v("#")]),t._v(" 6. document.domain + iframe")]),t._v(" "),a("p",[t._v("使用于二级域名相同的情况，如a.test.com和b.test.com适用于该方式；")]),t._v(" "),a("p",[t._v("给页面添加document.domain = 'test.com'就可以实现跨域")]),t._v(" "),a("h4",{attrs:{id:"_7-使用nginx服务器反向代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-使用nginx服务器反向代理"}},[t._v("#")]),t._v(" 7.使用nginx服务器反向代理")]),t._v(" "),a("p",[t._v("同源策略仅在浏览器端有限制，而在服务器上发起请求则不会收到同源策略的限制")]),t._v(" "),a("p",[a("strong",[t._v("正向代理(伪造客户端，服务器感知不到客户端)：代理屏蔽了客户端的存在，如使用代理访问谷歌，或使用代理绕过ip限制")])]),t._v(" "),a("p",[a("strong",[t._v("反向代理(伪造服务端，客户端感知不到服务器)：代理屏蔽了服务器的存在，如反向代理服务器将客户端请求转发给服务器，从而实现跨域")])]),t._v(" "),a("h4",{attrs:{id:"_8-面试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-面试"}},[t._v("#")]),t._v(" 8. 面试")]),t._v(" "),a("blockquote",[a("p",[t._v("跨域是因为浏览器的同源策略导致的不同协议，域名，端口之间的资源无法正常访问的问题。主要解决方法有 JSONP 和 CORS。")]),t._v(" "),a("p",[t._v("JSONP 的话主要是通过动态生成的 script 标签带上回调函数的名字，传给后台，后台将数据包裹在回调函数里面返回前台，然后执行回调函数。")]),t._v(" "),a("p",[t._v("CORS 的话要求浏览器和服务器都支持这个功能，然后浏览器就可以发送简单请求和非简单请求。")]),t._v(" "),a("p",[t._v("对于简单请求来说，浏览器直接发送请求，请求中携带 Origin 字段。如果该字段在服务器允许的列表中，则服务器响应该请求，并在响应头里面带上 Access-Control-Allow-Origin。若不在的话，则会被请求的 onerror 函数捕获。")]),t._v(" "),a("p",[t._v("对于非简单请求，浏览器先发送 option 预检请求并带上请求的方法和参数，如果服务器允许这些方法和参数，会返回对应的请求。如果不允许的话，会发送一个正常的 HTTP 响应，但是这个响应中没有 CORS 相关的信息。然后预检通过的话，浏览器就像发送简单请求一样发送请求。")])]),t._v(" "),a("blockquote",[a("p",[t._v("JSONP 与 CORS 的区别")])]),t._v(" "),a("p",[t._v("​        主要区别就是 JSONP 只能发起 get 请求，而 cors 可以发起任何请求")]),t._v(" "),a("p",[t._v("JSONP安全性不好，将参数和回调函数放在url中，容易被恶意攻击者获取到")]),t._v(" "),a("blockquote",[a("p",[t._v("其他可以跨域的标签")])]),t._v(" "),a("p",[t._v("​        img 和 iframe，所有具有 src 属性的都可以")]),t._v(" "),a("blockquote",[a("p",[t._v("其他跨域方式")])]),t._v(" "),a("p",[t._v("​        Web Socket")]),t._v(" "),a("h3",{attrs:{id:"_9-浏览器不同标签页通信"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-浏览器不同标签页通信"}},[t._v("#")]),t._v(" 9. 浏览器不同标签页通信")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("同源页面")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("cookie")])]),t._v(" "),a("li",[a("p",[t._v("localstorage")])])])]),t._v(" "),a("li",[a("p",[t._v("不同源页面")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("postMessage")])]),t._v(" "),a("li",[a("p",[t._v("webSocket")])])])])])])}),[],!1,null,null,null);s.default=e.exports}}]);