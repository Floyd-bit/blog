(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{648:function(t,a,s){"use strict";s.r(a);var n=s(11),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h3",{attrs:{id:"_1-问题描述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-问题描述"}},[t._v("#")]),t._v(" 1. 问题描述")]),t._v(" "),s("ul",[s("li",[t._v("首屏加载时间过长，用户体验差")]),t._v(" "),s("li",[t._v("首页轮播图加载很慢")]),t._v(" "),s("li",[t._v("NFT图片、市场图片加载很慢")])]),t._v(" "),s("h3",{attrs:{id:"_2-性能分析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-性能分析"}},[t._v("#")]),t._v(" 2. 性能分析")]),t._v(" "),s("p",[t._v("使用chrome提供的lighthouse工具进行网页的性能分析：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://picture-1305610595.cos.ap-guangzhou.myqcloud.com/202401161701579.png",alt:"lighthouse结果"}})]),t._v(" "),s("p",[t._v("lighthouse工具生成的性能优化建议：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://picture-1305610595.cos.ap-guangzhou.myqcloud.com/202401161702084.png",alt:"lighthouse建议"}})]),t._v(" "),s("p",[t._v("使用chrome浏览器network面板进行网络请求分析：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://picture-1305610595.cos.ap-guangzhou.myqcloud.com/202401161702021.png",alt:"网络请求"}})]),t._v(" "),s("ul",[s("li",[s("p",[t._v("缓存（disk cache + memory cache）")]),t._v(" "),s("p",[t._v("缓存的使用大大减少了图片请求耗时，并且节省了流量")]),t._v(" "),s("p",[t._v("合理的配置缓存(动静分离——缓存策略的选择)")]),t._v(" "),s("p",[s("img",{attrs:{src:"D:%5C%E5%A4%87%E4%BB%BD%5C%E7%AC%94%E8%AE%B0%5C%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB%5C%E4%B8%80%E6%AC%A1%E5%9B%BE%E7%89%87%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E6%88%98.assets%5C%E7%BC%93%E5%AD%98%E8%AF%B7%E6%B1%82.png",alt:"缓存请求"}})])]),t._v(" "),s("li",[s("p",[t._v("图片部署在不同的服务器上——HTTP协议版本不同（针对不同的HTTP协议需要采用不同的优化策略）")]),t._v(" "),s("p",[t._v("NFT图片——img.bytepic.cn HTTP1.1 Byte-nginx")]),t._v(" "),s("p",[t._v("图标静态资源图片——bytepic.cn HTTP2 nginx")]),t._v(" "),s("p",[t._v("用户头像——api.bytepic.cn HTTP2 Caddy(MinIO)")]),t._v(" "),s("p",[t._v("Banner图片——banner-img.bytepic.cn HTTP3/QUIC Cloudflare")])]),t._v(" "),s("li",[s("p",[t._v("网络请求过程耗时")]),t._v(" "),s("p",[t._v("DNS + 排队 + TCP连接 + 请求/响应 + 下载内容")])])]),t._v(" "),s("p",[s("img",{attrs:{src:"D:%5C%E5%A4%87%E4%BB%BD%5C%E7%AC%94%E8%AE%B0%5C%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB%5C%E4%B8%80%E6%AC%A1%E5%9B%BE%E7%89%87%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E6%88%98.assets%5C%E8%AF%B7%E6%B1%82%E8%BF%87%E7%A8%8B.png",alt:"请求过程"}})]),t._v(" "),s("h3",{attrs:{id:"_3-网络优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-网络优化"}},[t._v("#")]),t._v(" 3. 网络优化")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("DNS查询——DNS预解析")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[t._v("\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- DNS预解析 --\x3e")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("http-equiv")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("x-dns-prefetch-control"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("on"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("dns-prefetch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("https://assets.bytepic.cn/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("dns-prefetch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("https://banner-img.bytepic.cn/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("dns-prefetch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("https://api.bytepic.cn/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("排队、建立连接")]),t._v(" "),s("p",[t._v("HTTP1.1存在队头阻塞问题，且同一个域名下最多存在6~8条TCP连接")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://juejin.cn/post/6844903667569541133",target:"_blank",rel:"noopener noreferrer"}},[t._v("HTTP2 详解 - 掘金 (juejin.cn)"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("img",{attrs:{src:"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/31/1658dc55395175fd~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp",alt:"image"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/31/1658dc553efe90bb~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp",alt:"image"}})]),t._v(" "),s("p",[t._v("合并文件、内联资源、雪碧图、域名分片对于 HTTP/2 来说是不必要的，使用 h2 尽可能将资源细粒化，文件分解地尽可能散，不用担心请求数多")])]),t._v(" "),s("li",[s("p",[t._v("等待服务器响应——cdn")]),t._v(" "),s("p",[t._v("成本问题——cdn流量费用")])]),t._v(" "),s("li",[s("p",[t._v("下载内容——图片优化, 减小图片体积")])]),t._v(" "),s("li",[s("p",[t._v("缓存")]),t._v(" "),s("p",[t._v("​\t在性能分析时为了得到更准确的数据，浏览器使用了无痕模式(不保存cache、cookie)，所以所有的网络请求都是从服务器上获取的数据。在标准模式下，我们再查看chrome network面板：\n"),s("img",{attrs:{src:"D:%5C%E5%A4%87%E4%BB%BD%5C%E7%AC%94%E8%AE%B0%5C%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB%5C%E4%B8%80%E6%AC%A1%E5%9B%BE%E7%89%87%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E6%88%98.assets%5C%E7%BC%93%E5%AD%98%E8%AF%B7%E6%B1%82-1706261021075.png",alt:"缓存请求"}})]),t._v(" "),s("p",[t._v("​\t可以看到响应码是200，使用了强缓存，图片资源直接从缓存（disk cache、memory cache）中读取, 大大减少了用户等待时间，也减轻了服务器的压力。")])])]),t._v(" "),s("h3",{attrs:{id:"_4-图片优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-图片优化"}},[t._v("#")]),t._v(" 4. 图片优化")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("图片格式的选取")]),t._v(" "),s("p",[t._v("jpg(jpeg)、png、svg、base64、webp")]),t._v(" "),s("p",[t._v("https://mp.weixin.qq.com/s/FtaUER4Hv3RzCReKTqIRNQ")]),t._v(" "),s("p",[s("img",{attrs:{src:"D:%5C%E5%A4%87%E4%BB%BD%5C%E7%AC%94%E8%AE%B0%5C%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB%5C%E4%B8%80%E6%AC%A1%E5%9B%BE%E7%89%87%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E6%88%98.assets%5C640.png",alt:"640"}})]),t._v(" "),s("p",[t._v("webp的兼容性问题——优雅降级")])]),t._v(" "),s("li",[s("p",[t._v("图片压缩")]),t._v(" "),s("p",[t._v("压缩工具——TinyPNG "),s("a",{attrs:{href:"https://juejin.cn/post/6844903798658318343",target:"_blank",rel:"noopener noreferrer"}},[t._v("PNG图片压缩原理解析 - 掘金 (juejin.cn)"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("前端引用的静态资源图片(背景图片jpg png、小图标svg)共128个、占用25.2MB")]),t._v(" "),s("p",[t._v("PNG压缩 体积减小60%-70% TintPNG 压缩完后128张图片占用8.5MB")]),t._v(" "),s("p",[t._v("打包优化：使用webpack插件压缩项目中的图片文件")])])]),t._v(" "),s("h3",{attrs:{id:"_5-总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-总结"}},[t._v("#")]),t._v(" 5. 总结")]),t._v(" "),s("p",[t._v("优化方向：")]),t._v(" "),s("p",[t._v("连接：HTTP2.0升级、DNS prefetch")]),t._v(" "),s("p",[t._v("服务器响应：cdn加速、缓存")]),t._v(" "),s("p",[t._v("加载：图片压缩、用户体验（懒加载、骨架屏）")])])}),[],!1,null,null,null);a.default=e.exports}}]);